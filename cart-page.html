<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v27.1.0/dist/font-face.css" rel="stylesheet"
    type="text/css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

  <link rel="stylesheet" href="assets/css/main.css" />

  <title>NeoTechShop|سبد خرید</title>
</head>
  
<body>

<div class="cart-container">
  <h2>سبد خرید شما</h2>
  <div id="cartItems" class="cart-items"></div>

  <div class="cart-summary">
    <p>جمع کل: <span id="cartTotal">۰ افغانی</span></p>
    <div class="cart-buttons">
      <a href="index.html#product" class="btn">ادامه خرید</a>
      <button id="checkoutBtn" class="btn">پرداخت</button>
    </div>
  </div>
</div>

<script>
  // ======== Cart Logic ========
  const cartItemsContainer = document.getElementById('cartItems');
  const cartTotal = document.getElementById('cartTotal');
  const checkoutBtn = document.getElementById('checkoutBtn');

  // گرفتن سبد خرید از localStorage
  function getCart() {
    return JSON.parse(localStorage.getItem('cart')) || [];
  }

  function saveCart(cart) {
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartUI();
  }

  function removeFromCart(id) {
    let cart = getCart().filter(item => item.id !== id);
    saveCart(cart);
  }

  function changeQuantity(id, change) {
    let cart = getCart();
    const item = cart.find(p => p.id === id);
    if (!item) return;
    item.quantity += change;
    if (item.quantity <= 0) {
      cart = cart.filter(p => p.id !== id);
    }
    saveCart(cart);
  }

  function updateCartUI() {
    const cart = getCart();
    cartItemsContainer.innerHTML = '';
    if(cart.length === 0){
      cartItemsContainer.innerHTML = '<p>سبد خرید شما خالی است.</p>';
      cartTotal.textContent = '۰ افغانی';
      return;
    }

    let total = 0;
    cart.forEach(item=>{
      const price = item.price * item.quantity;
      total += price;

      const div = document.createElement('div');
      div.classList.add('cart-item');
      div.innerHTML = `
        <img src="${item.image}" alt="${item.name}">
        <div class="cart-item-details">
          <p>${item.name}</p>
          <div class="cart-qty-controls">
            <button class="qty-btn decrease" data-id="${item.id}">−</button>
            <span>${item.quantity}</span>
            <button class="qty-btn increase" data-id="${item.id}">+</button>
          </div>
          <small>${(item.price * item.quantity).toLocaleString()} افغانی</small>
        </div>
        <button class="remove-btn" data-id="${item.id}">حذف</button>
      `;
      cartItemsContainer.appendChild(div);
    });

    cartTotal.textContent = total.toLocaleString() + ' افغانی';

    // Delete buttons
    document.querySelectorAll('.remove-btn').forEach(btn =>
      btn.addEventListener('click', () => removeFromCart(parseInt(btn.dataset.id)))
    );

    // Quantity buttons
    document.querySelectorAll('.increase').forEach(btn =>
      btn.addEventListener('click', () => changeQuantity(parseInt(btn.dataset.id), 1))
    );
    document.querySelectorAll('.decrease').forEach(btn =>
      btn.addEventListener('click', () => changeQuantity(parseInt(btn.dataset.id), -1))
    );
  }

  updateCartUI();

  // ======== Checkout Button ========
  checkoutBtn.addEventListener('click', (e)=>{
    const loggedIn = sessionStorage.getItem('loggedIn') === 'true';
    if(!loggedIn){
      e.preventDefault();
      sessionStorage.setItem('fromCheckout','true');
      window.location.href = 'auth.html'; // هدایت به صفحه ورود/ثبت‌نام
    } else {
      window.location.href = 'checkout.html'; // اگر وارد شده → ادامه پرداخت
    }
  });

  

</script>

</body>
</html>
