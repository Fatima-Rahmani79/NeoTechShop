<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v27.1.0/dist/font-face.css" rel="stylesheet"
    type="text/css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

  <link rel="stylesheet" href="assets/css/main.css" />

  <title>NeoTechShop|ورود، ثبت نام</title>
</head>
<body class="auth-page">

  <div class="auth-container">
    <!-- Login Form -->
    <div id="loginForm" class="form-section active">
      <h2>ورود به حساب</h2>
      <form id="loginFormElement" novalidate>
        <label for="loginEmail">ایمیل: </label>
        <input type="email" id="loginEmail" placeholder="ایمیل" required />
        <label for="loginPassword">رمز عبور: </label>
        <input type="password" id="loginPassword" placeholder="رمز عبور" required minlength="6" />
        <button type="submit" class="btn">ورود</button>
      </form>
      <p>حساب ندارید؟ <a href="#" id="showRegister">ثبت‌نام</a></p>
    </div>

    <!-- Register Form -->
    <div id="registerForm" class="form-section">
      <h2>ایجاد حساب جدید</h2>
      <form id="registerFormElement" novalidate>
        <label for="regUsername">نام کاربری: </label>
        <input type="text" id="regUsername"  required minlength="3" />
        <label for="regEmail">ایمیل: </label>
        <input type="email" id="regEmail" required />
        <label for="regPassword">رمز عبور: </label>
        <input type="password" id="regPassword" placeholder="رمز عبور باید حداقل 6 کارکتر باشد." required minlength="6" />
        <button type="submit" class="btn">ثبت‌نام</button>
      </form>
      <p>قبلاً حساب دارید؟ <a href="#" id="showLogin">ورود</a></p>
    </div>
  </div>

  <div id="toast"></div>

  <script>
    // ==== تغییر بین فرم‌ها ====
    const showRegister = document.getElementById('showRegister');
    const showLogin = document.getElementById('showLogin');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');

    showRegister.addEventListener('click', (e) => {
      e.preventDefault();
      registerForm.classList.add('active');
      loginForm.classList.remove('active');
    });

    showLogin.addEventListener('click', (e) => {
      e.preventDefault();
      loginForm.classList.add('active');
      registerForm.classList.remove('active');
    });

    // ==== Toast Function ====
    function showToast(message, duration = 3000) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, duration);
    }

    // ==== ثبت‌نام ====
    document.getElementById('registerFormElement').addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('regUsername').value.trim();
      const email = document.getElementById('regEmail').value.trim();
      const password = document.getElementById('regPassword').value.trim();

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!username || !email || !password) {
        showToast('لطفاً تمام فیلدها را پر کنید.');
        return;
      }
      if (!emailRegex.test(email)) {
        showToast('ایمیل معتبر نیست.');
        return;
      }
      if (password.length < 6) {
        showToast('رمز عبور باید حداقل ۶ کاراکتر باشد.');
        return;
      }

      localStorage.setItem('user', JSON.stringify({ username, email, password }));
      showToast('ثبت‌نام موفق بود! لطفاً وارد شوید.');
      showLogin.click();
      e.target.reset();
    });

    // ==== ورود ====
    document.getElementById('loginFormElement').addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value.trim();
      const user = JSON.parse(localStorage.getItem('user'));

      if (!email || !password) {
        showToast('لطفاً ایمیل و رمز عبور را وارد کنید.');
        return;
      }

      if (user && user.email === email && user.password === password) {
        sessionStorage.setItem('loggedIn', true);
        showToast(`خوش آمدی، ${user.username}!`);
        setTimeout(() => {
          if (sessionStorage.getItem('fromCheckout') === 'true') {
            sessionStorage.removeItem('fromCheckout');
            window.location.href = 'checkout.html';
          } else {
            window.location.href = 'index.html';
          }
        }, 1500);
      } else {
        showToast('ایمیل یا رمز عبور اشتباه است.');
      }
    });
  </script>
</body>
</html>
